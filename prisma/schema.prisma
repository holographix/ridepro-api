// Prisma schema for RidePro Training Platform
// Database: Supabase PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // URLs are configured in prisma.config.ts
}

// ============================================
// USER MANAGEMENT (Clerk integration ready)
// ============================================

enum Sex {
  MALE
  FEMALE
}

enum AthleteCategory {
  AMATORE
  JUNIORES
  U23
  ELITE
  PRO
}

enum TerrainType {
  HILLS     // 10-15min climbs
  FLAT      // Pianura
  MOUNTAINS // 1h+ climbs
}

enum DisciplineType {
  MTB
  GRAVEL_CICLOCROSS
  ROAD
}

enum DisciplineSubType {
  // MTB sub-types
  MTB_XC_90MIN
  MTB_GF_MARATHON_3H
  MTB_NO_RACE
  // Gravel/Ciclocross sub-types
  GRAVEL_RACE_1H
  GRAVEL_RACE_2H
  GRAVEL_ULTRA_6H
  GRAVEL_NO_RACE
  // Road sub-types
  ROAD_CIRCUITS_1H
  ROAD_GRAN_FONDO_2H
  ROAD_ULTRA_6H
  ROAD_NO_RACE
}

enum ActivityType {
  OUTDOOR_CYCLING
  INDOOR_CYCLING
  WORKOUT_HOME
  WORKOUT_GYM
  CROSS_RUNNING
  CROSS_SWIMMING
  CROSS_SKIING
}

// Assessment status for 2-day protocol
enum AssessmentStatus {
  DAY1_PENDING      // Test started, Day 1 not yet completed
  DAY1_COMPLETED    // Day 1 complete, waiting for Day 2
  DAY2_PENDING      // Day 2 started but not completed
  COMPLETED         // Both days completed
  EXPIRED           // Day 1 completed but 15-day window elapsed
}

model User {
  id            String    @id @default(uuid())
  clerkUserId   String?   @unique @map("clerk_user_id") // Will be set when Clerk is integrated
  email         String    @unique
  fullName      String?   @map("full_name")
  ftp           Int?      // Functional Threshold Power (watts)
  maxHR         Int?      @map("max_hr")     // Maximum heart rate (bpm)
  restingHR     Int?      @map("resting_hr") // Resting heart rate (bpm) - for Karvonen
  avatarUrl     String?   @map("avatar_url")

  // General availability notes (athlete can explain their typical schedule)
  availabilityNotes String? @map("availability_notes")

  // ============================================
  // ONBOARDING - Personal Info
  // ============================================
  birthday          DateTime?       @db.Date
  sex               Sex?
  lastMenstrualDate DateTime?       @map("last_menstrual_date") @db.Date

  // ============================================
  // ONBOARDING - Physical
  // ============================================
  heightCm          Float?          @map("height_cm")
  weightKg          Float?          @map("weight_kg")

  // ============================================
  // ONBOARDING - Profile
  // ============================================
  athleteCategory   AthleteCategory? @map("athlete_category")
  terrain           TerrainType?

  // ============================================
  // ONBOARDING - Equipment
  // ============================================
  hasPowerMeter     Boolean         @default(false) @map("has_power_meter")
  hasHRMonitor      Boolean         @default(false) @map("has_hr_monitor")

  // ============================================
  // ONBOARDING - Status
  // ============================================
  onboardingCompleted Boolean       @default(false) @map("onboarding_completed")
  onboardingStep      Int?          @map("onboarding_step")

  // ============================================
  // TOUR & SETUP CHECKLIST
  // Track whether user has completed guided tour and setup tasks
  // ============================================
  tourCompleted       Boolean       @default(false) @map("tour_completed")
  tourDismissed       Boolean       @default(false) @map("tour_dismissed")
  // Setup checklist items (JSON array of completed task IDs)
  // e.g., ["profile", "availability", "goals", "assessment"]
  setupChecklistCompleted String[]  @default([]) @map("setup_checklist_completed")

  // Coach-Athlete relationships (many-to-many)
  // A user can be both a coach AND an athlete simultaneously
  coachingRelationships  CoachAthleteRelationship[] @relation("CoachRelationships")
  athleteRelationships   CoachAthleteRelationship[] @relation("AthleteRelationships")
  inviteCodes            CoachInviteCode[]
  sentInvitations        EmailInvitation[] @relation("SentInvitations")
  receivedInvitations    EmailInvitation[] @relation("ReceivedInvitations")

  // Related data
  availability     AthleteAvailability[]
  unavailableDates UnavailableDate[]
  goals            Goal[]
  trainingWeeks    TrainingWeek[]        @relation("AthleteWeeks")
  coachedWeeks     TrainingWeek[]        @relation("CoachWeeks")
  customWorkouts   Workout[]             @relation("CoachWorkouts")
  customCategories WorkoutCategory[]     @relation("CoachCategories")

  // Onboarding & Assessment relations
  disciplines       AthleteDiscipline[]
  activityTypes     AthleteActivityType[]
  assessments       Assessment[]

  // Training zones
  powerZones        PowerZone?
  hrZones           HRZone?

  // Completed activities (imported FIT files)
  activities        Activity[]        @relation("AthleteActivities")

  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

// ============================================
// COACH-ATHLETE RELATIONSHIPS
// Many-to-many: Users can be coaches to multiple athletes
// and athletes can have multiple coaches
// ============================================

enum RelationshipStatus {
  PENDING   // Invitation sent, awaiting acceptance
  ACTIVE    // Active coaching relationship
  PAUSED    // Temporarily paused (e.g., off-season)
  ENDED     // Relationship ended
}

model CoachAthleteRelationship {
  id          String             @id @default(uuid())

  coachId     String             @map("coach_id")
  coach       User               @relation("CoachRelationships", fields: [coachId], references: [id], onDelete: Cascade)

  athleteId   String             @map("athlete_id")
  athlete     User               @relation("AthleteRelationships", fields: [athleteId], references: [id], onDelete: Cascade)

  status      RelationshipStatus @default(PENDING)

  // Optional metadata
  notes       String?            // Coach's private notes about this athlete
  startedAt   DateTime?          @map("started_at")  // When relationship became active
  endedAt     DateTime?          @map("ended_at")    // When relationship ended

  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")

  // A coach can only have one relationship with each athlete
  @@unique([coachId, athleteId])
  @@index([coachId])
  @@index([athleteId])
  @@index([status])
  @@map("coach_athlete_relationships")
}

// Invitation codes for easy athlete onboarding
// Coach generates a code, athlete uses it to connect
model CoachInviteCode {
  id          String    @id @default(uuid())
  code        String    @unique // e.g., "COACH-ABC123"

  coachId     String    @map("coach_id")
  coach       User      @relation(fields: [coachId], references: [id], onDelete: Cascade)

  // Limits
  maxUses     Int?      @map("max_uses")     // null = unlimited
  usedCount   Int       @default(0) @map("used_count")
  expiresAt   DateTime? @map("expires_at")   // null = never expires

  isActive    Boolean   @default(true) @map("is_active")

  createdAt   DateTime  @default(now()) @map("created_at")

  @@index([coachId])
  @@index([code])
  @@map("coach_invite_codes")
}

// ============================================
// EMAIL INVITATIONS
// Coach sends email invitation to athlete
// ============================================

enum InvitationStatus {
  PENDING     // Email sent, awaiting action
  ACCEPTED    // Athlete accepted the invitation
  DECLINED    // Athlete declined the invitation
  EXPIRED     // Invitation expired
  CANCELLED   // Coach cancelled the invitation
}

model EmailInvitation {
  id              String            @id @default(uuid())
  token           String            @unique // Secure token for invitation link (our internal token)
  clerkInvitationId String?         @unique @map("clerk_invitation_id") // Clerk's invitation ID

  // Coach who sent the invitation
  coachId         String            @map("coach_id")
  coach           User              @relation("SentInvitations", fields: [coachId], references: [id], onDelete: Cascade)

  // Invited athlete info
  athleteEmail    String            @map("athlete_email")
  athleteName     String?           @map("athlete_name")

  // If athlete already exists, link to their user record
  existingUserId  String?           @map("existing_user_id")
  existingUser    User?             @relation("ReceivedInvitations", fields: [existingUserId], references: [id])

  // Status tracking
  status          InvitationStatus  @default(PENDING)
  personalMessage String?           @map("personal_message") // Optional message from coach

  // Timing
  expiresAt       DateTime          @map("expires_at")
  sentAt          DateTime          @default(now()) @map("sent_at")
  acceptedAt      DateTime?         @map("accepted_at")

  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  @@index([coachId])
  @@index([athleteEmail])
  @@index([token])
  @@index([status])
  @@map("email_invitations")
}

// ============================================
// WORKOUT LIBRARY
// ============================================

model WorkoutCategory {
  id          String    @id @default(uuid())
  slug        String    @unique
  name        String
  description String?
  sortOrder   Int       @default(0) @map("sort_order")

  // Ownership (null = global/system category)
  coachId     String?   @map("coach_id")
  coach       User?     @relation("CoachCategories", fields: [coachId], references: [id])

  workouts    Workout[]

  createdAt   DateTime  @default(now()) @map("created_at")

  @@index([coachId])
  @@map("workout_categories")
}

enum DurationCategory {
  SHORT  // < 1 hour
  MEDIUM // 1-2 hours
  LONG   // > 2 hours
}

enum Environment {
  INDOOR
  OUTDOOR
  ANY
}

enum Intensity {
  EASY
  MODERATE
  HARD
  VERY_HARD
}

model Workout {
  id                String           @id @default(uuid())
  slug              String           @unique
  name              String
  title             String?          // Original title from source
  description       String?

  // Metadata
  durationSeconds   Int              @map("duration_seconds")
  durationCategory  DurationCategory @map("duration_category")
  tssPlanned        Float?           @map("tss_planned")
  ifPlanned         Float?           @map("if_planned") // 0.00 - 1.50
  // Workout type for UI display (outdoorCycling, indoorCycling, gymHome, gymFacility, crossTraining, other)
  workoutType       String           @default("outdoorCycling") @map("workout_type")

  // Filtering tags
  environment       Environment      @default(ANY)
  intensity         Intensity?

  // The workout structure (stored as JSON)
  structure         Json             // The nested structure for visualizer
  rawJson           Json?            @map("raw_json") // Full original JSON

  // Attachments (file URLs)
  attachments       String[]         @default([]) // File URLs for workout attachments

  // Category
  categoryId        String           @map("category_id")
  category          WorkoutCategory  @relation(fields: [categoryId], references: [id])

  // Ownership (null = global/system library)
  coachId           String?          @map("coach_id")
  coach             User?            @relation("CoachWorkouts", fields: [coachId], references: [id])
  isPublic          Boolean          @default(true) @map("is_public")

  // Scheduled instances
  scheduledWorkouts ScheduledWorkout[]

  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  @@index([categoryId])
  @@index([durationCategory])
  @@index([environment])
  @@index([coachId])
  @@map("workouts")
}

// ============================================
// TRAINING CALENDAR
// ============================================

model TrainingWeek {
  id          String              @id @default(uuid())
  weekStart   DateTime            @map("week_start") // Always a Monday
  notes       String?

  // Relationships
  athleteId   String              @map("athlete_id")
  athlete     User                @relation("AthleteWeeks", fields: [athleteId], references: [id])

  coachId     String?             @map("coach_id")
  coach       User?               @relation("CoachWeeks", fields: [coachId], references: [id])

  scheduledWorkouts ScheduledWorkout[]

  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  @@unique([athleteId, weekStart])
  @@index([athleteId])
  @@map("training_weeks")
}

// How athlete felt after workout
enum WorkoutFeeling {
  GREAT
  GOOD
  OK
  TIRED
  EXHAUSTED
}

model ScheduledWorkout {
  id              String        @id @default(uuid())
  dayIndex        Int           @map("day_index") // 0 = Monday, 6 = Sunday
  sortOrder       Int           @default(0) @map("sort_order") // For multiple workouts per day
  notes           String?       // Coach notes when scheduling
  completed       Boolean       @default(false)
  completedAt     DateTime?     @map("completed_at")

  // ============================================
  // SKIP TRACKING (when athlete can't complete workout)
  // ============================================
  skipped         Boolean       @default(false)
  skipReason      String?       @map("skip_reason")  // e.g., "Sick", "Injury", "No time"
  skippedAt       DateTime?     @map("skipped_at")

  // ============================================
  // ACTUAL RESULTS (filled by athlete after completion)
  // ============================================
  actualDurationSeconds Int?            @map("actual_duration_seconds")
  actualTSS             Float?          @map("actual_tss")
  actualIF              Float?          @map("actual_if")
  avgPower              Int?            @map("avg_power")       // Watts
  avgHeartRate          Int?            @map("avg_heart_rate")  // BPM
  rpe                   Int?            // Rate of Perceived Exertion (1-10)
  feeling               WorkoutFeeling? // How athlete felt
  resultNotes           String?         @map("result_notes")    // Athlete's notes

  // Relationships
  trainingWeekId  String        @map("training_week_id")
  trainingWeek    TrainingWeek  @relation(fields: [trainingWeekId], references: [id], onDelete: Cascade)

  workoutId       String        @map("workout_id")
  workout         Workout       @relation(fields: [workoutId], references: [id])

  // ============================================
  // WORKOUT STRUCTURE OVERRIDES
  // When a coach modifies a scheduled workout for a specific athlete/day,
  // these fields contain the customized values. If null, use original workout data.
  // ============================================
  structureOverride Json?    @map("structure_override")  // Modified workout structure
  durationOverride  Int?     @map("duration_override")   // Modified duration in seconds
  tssOverride       Float?   @map("tss_override")        // Recalculated TSS
  ifOverride        Float?   @map("if_override")         // Recalculated IF
  isModified        Boolean  @default(false) @map("is_modified") // Quick flag for modified workouts

  // Linked completed activities (imported from FIT files)
  activities        Activity[]

  createdAt       DateTime      @default(now()) @map("created_at")

  @@index([trainingWeekId, dayIndex])
  @@map("scheduled_workouts")
}

// ============================================
// ATHLETE PROFILE
// ============================================

enum TimeSlot {
  MORNING
  AFTERNOON
  EVENING
}

model AthleteAvailability {
  id          String      @id @default(uuid())
  dayIndex    Int         @map("day_index") // 0 = Monday, 6 = Sunday
  available   Boolean     @default(true)
  timeSlots   TimeSlot[]  @map("time_slots")
  maxHours    Float?      @map("max_hours") // e.g., 2.5 hours
  notes       String?

  // Relationships
  athleteId   String      @map("athlete_id")
  athlete     User        @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([athleteId, dayIndex])
  @@map("athlete_availability")
}

// Specific dates when athlete is unavailable (vacations, travel, etc.)
model UnavailableDate {
  id          String    @id @default(uuid())
  date        DateTime  @db.Date // The specific unavailable date
  reason      String?   // Optional reason (e.g., "Vacation", "Travel")

  // Relationships
  athleteId   String    @map("athlete_id")
  athlete     User      @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt   DateTime  @default(now()) @map("created_at")

  @@unique([athleteId, date])
  @@index([athleteId])
  @@index([date])
  @@map("unavailable_dates")
}

enum GoalPriority {
  A
  B
  C
}

model Goal {
  id              String        @id @default(uuid())
  name            String
  eventDate       DateTime?     @map("event_date")
  priority        GoalPriority  @default(B)
  eventType       String?       @map("event_type") // 'Gran Fondo', 'Time Trial', etc.
  targetDuration  String?       @map("target_duration") // '4 hours', '40km', etc.
  notes           String?

  // Relationships
  athleteId       String        @map("athlete_id")
  athlete         User          @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt       DateTime      @default(now()) @map("created_at")

  @@index([athleteId])
  @@map("goals")
}

// ============================================
// ONBOARDING - Athlete Disciplines & Activities
// ============================================

model AthleteDiscipline {
  id          String            @id @default(uuid())
  athleteId   String            @map("athlete_id")
  athlete     User              @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  discipline  DisciplineType
  subType     DisciplineSubType @map("sub_type")
  createdAt   DateTime          @default(now()) @map("created_at")

  @@unique([athleteId, discipline])
  @@index([athleteId])
  @@map("athlete_disciplines")
}

model AthleteActivityType {
  id           String       @id @default(uuid())
  athleteId    String       @map("athlete_id")
  athlete      User         @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  activityType ActivityType @map("activity_type")

  @@unique([athleteId, activityType])
  @@index([athleteId])
  @@map("athlete_activity_types")
}

// ============================================
// ASSESSMENTS - Fitness Testing
// ============================================

// ============================================
// 2-DAY ASSESSMENT PROTOCOL
// Day 1: 1'/2'/5' efforts on 6-7% gradient
// Day 2: 5" sprint + 12' climb on 6-7% gradient
// Athletes have 15 days to complete Day 2 after Day 1
// ============================================
model Assessment {
  id                  String            @id @default(uuid())
  athleteId           String            @map("athlete_id")
  athlete             User              @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  // Test state and timing
  testStatus          AssessmentStatus  @default(DAY1_PENDING) @map("test_status")
  startedAt           DateTime          @default(now()) @map("started_at")        // When test was initiated
  day1CompletedAt     DateTime?         @map("day1_completed_at")                // When Day 1 was completed
  day2CompletedAt     DateTime?         @map("day2_completed_at")                // When Day 2 was completed
  expiresAt           DateTime?         @map("expires_at")                        // 15 days after day1CompletedAt

  // ============================================
  // DAY 1: Power Profile Test (1'/2'/5')
  // All AVERAGE power over the effort duration
  // Performed on 6-7% gradient climb
  // ============================================
  effort1minAvgPower  Int?              @map("effort_1min_avg_power")  // Avg power during 1' effort (W)
  effort1minMaxHR     Int?              @map("effort_1min_max_hr")     // Max HR during 1' effort (bpm)
  effort2minAvgPower  Int?              @map("effort_2min_avg_power")  // Avg power during 2' effort (W)
  effort2minMaxHR     Int?              @map("effort_2min_max_hr")     // Max HR during 2' effort (bpm)
  effort5minAvgPower  Int?              @map("effort_5min_avg_power")  // Avg power during 5' effort (W)
  effort5minMaxHR     Int?              @map("effort_5min_max_hr")     // Max HR during 5' effort (bpm)

  // ============================================
  // DAY 2: Sprint + Endurance Test (5"/12')
  // 5" = PEAK power, 12' = AVERAGE power
  // Performed on 6-7% gradient climb
  // ============================================
  sprint5secPeakPower Int?              @map("sprint_5sec_peak_power") // Peak power during 5" sprint (W)
  sprint5secMaxHR     Int?              @map("sprint_5sec_max_hr")     // Max HR during 5" sprint (bpm)
  climb12minAvgPower  Int?              @map("climb_12min_avg_power")  // Avg power during 12' climb (W)
  climb12minMaxHR     Int?              @map("climb_12min_max_hr")     // Max HR during 12' climb (bpm)

  // ============================================
  // CALCULATED VALUES
  // Computed when Day 2 is completed
  // ============================================
  estimatedFTP        Int?              @map("estimated_ftp")          // FTP = climb12minAvgPower Ã— 0.95
  maxHR               Int?              @map("max_hr")                 // Max across all HR values
  notes               String?

  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  @@index([athleteId])
  @@index([testStatus])
  @@index([day1CompletedAt])
  @@index([day2CompletedAt])
  @@index([expiresAt])
  @@map("assessments")
}

// ============================================
// POWER & HR ZONES
// ============================================

model PowerZone {
  id          String   @id @default(uuid())
  athleteId   String   @unique @map("athlete_id")
  athlete     User     @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  // Zone system
  zoneSystem  String   @default("COGGAN") @map("zone_system") // COGGAN, POLARIZED, CUSTOM

  // Custom zone boundaries (% of FTP)
  zone1Max    Float    @default(55)   @map("zone1_max")  // Active Recovery
  zone2Max    Float    @default(75)   @map("zone2_max")  // Endurance
  zone3Max    Float    @default(90)   @map("zone3_max")  // Tempo
  zone4Max    Float    @default(105)  @map("zone4_max")  // Threshold
  zone5Max    Float    @default(120)  @map("zone5_max")  // VO2Max
  zone6Max    Float    @default(150)  @map("zone6_max")  // Anaerobic
  // Zone 7 = > zone6Max (Neuromuscular)

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("power_zones")
}

model HRZone {
  id          String   @id @default(uuid())
  athleteId   String   @unique @map("athlete_id")
  athlete     User     @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  // Zone system
  zoneSystem  String   @default("STANDARD") @map("zone_system") // STANDARD, KARVONEN, CUSTOM

  // Custom zone boundaries (% of max HR or HRR for Karvonen)
  zone1Max    Float    @default(60)   @map("zone1_max")  // Recovery
  zone2Max    Float    @default(70)   @map("zone2_max")  // Endurance
  zone3Max    Float    @default(80)   @map("zone3_max")  // Tempo
  zone4Max    Float    @default(90)   @map("zone4_max")  // Threshold
  zone5Max    Float    @default(100)  @map("zone5_max")  // Max

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("hr_zones")
}

// ============================================
// ACTIVITY IMPORT (FIT Files, Completed Rides)
// ============================================

enum ActivitySource {
  ZWIFT
  TRAININGPEAKS
  GARMIN
  WAHOO
  STRAVA
  MANUAL
}

enum ActivityFileFormat {
  FIT
  TCX
  GPX
  MANUAL
}

// Completed activity with full telemetry data from FIT files
model Activity {
  id              String    @id @default(uuid())

  // Athlete who completed the activity
  athleteId       String    @map("athlete_id")
  athlete         User      @relation("AthleteActivities", fields: [athleteId], references: [id], onDelete: Cascade)

  // Optional pairing with scheduled workout
  scheduledWorkoutId String?           @map("scheduled_workout_id")
  scheduledWorkout   ScheduledWorkout? @relation(fields: [scheduledWorkoutId], references: [id], onDelete: SetNull)

  // Activity metadata
  name            String              // Activity name (e.g., "Morning Ride", workout title)
  activityType    ActivityType        @map("activity_type") // OUTDOOR_CYCLING, INDOOR_CYCLING, etc.
  source          ActivitySource      // Where it came from
  fileFormat      ActivityFileFormat  @map("file_format")

  // Timing
  startTime       DateTime            @map("start_time")
  endTime         DateTime?           @map("end_time")
  durationSeconds Int                 @map("duration_seconds")
  movingTime      Int?                @map("moving_time") // Time actually moving (excluding stops)

  // Distance & Elevation
  distanceMeters  Float?              @map("distance_meters")
  elevationGain   Float?              @map("elevation_gain")  // Total ascent in meters
  elevationLoss   Float?              @map("elevation_loss")  // Total descent in meters

  // Power metrics (if available)
  avgPower        Int?                @map("avg_power")        // Average power (watts)
  maxPower        Int?                @map("max_power")        // Max power (watts)
  normalizedPower Int?                @map("normalized_power") // NP (watts)

  // Heart rate metrics (if available)
  avgHeartRate    Int?                @map("avg_heart_rate")   // Average HR (bpm)
  maxHeartRate    Int?                @map("max_heart_rate")   // Max HR (bpm)

  // Cadence (if available)
  avgCadence      Int?                @map("avg_cadence")      // Average cadence (rpm)
  maxCadence      Int?                @map("max_cadence")      // Max cadence (rpm)

  // Speed
  avgSpeed        Float?              @map("avg_speed")        // m/s
  maxSpeed        Float?              @map("max_speed")        // m/s

  // Training metrics
  tss             Float?              // Training Stress Score
  intensityFactor Float?              @map("intensity_factor") // IF (NP/FTP)
  calories        Int?                // Estimated calories

  // GPS data
  hasGPS          Boolean             @default(false) @map("has_gps")
  startLatitude   Float?              @map("start_latitude")  // Start point
  startLongitude  Float?              @map("start_longitude")

  // Weather (outdoor activities)
  temperature     Float?              // Celsius

  // Raw telemetry data (second-by-second)
  // Stored as JSONB for flexibility
  telemetryData   Json?               @map("telemetry_data") @db.JsonB
  // Structure: { records: [{ timestamp, lat, lng, altitude, power, hr, cadence, speed, distance, temp }] }

  // Lap/segment data
  laps            Json?               @db.JsonB
  // Structure: { laps: [{ startTime, endTime, duration, distance, avgPower, avgHR, etc. }] }

  // Original file storage
  originalFilename String?            @map("original_filename")
  fileSize         Int?               @map("file_size") // bytes

  // Notes
  notes            String?            // Athlete's notes about the activity

  // Timestamps
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")

  @@index([athleteId, startTime])
  @@index([scheduledWorkoutId])
  @@map("activities")
}

